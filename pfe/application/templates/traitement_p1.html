{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="{% static 'css/newglobal.css' %}" />
    <link rel="stylesheet" href="{% static 'css/traitement_p1.css'%}"  />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap"
    />
  </head>
  <body>
    <div class="div_global">
      <img class="background" alt="" src="{% static 'images/finale_img.png'%}" />

      <div class="div1">
        <div class="div2">

          <a class="trait1" style="color:white;" href="traitement_mansuel">
            <img
              class="trait2"
              alt=""
              src="{% static 'images/traitement-de-linformation (1).png'%}"
            />

            <div class="trait3">Traitement Mansuelle</div>
          </a>
          <a class="trait_p1" style="color:white;" href="traitement_p1">
            <div class="affiche1">
              <p class="affiche2">Affichage Bilan</p>
              <p class="affiche2">par périmetre</p>
            </div>
            <img class="affiche3" alt="" src="{% static 'images/bilan.png'%}" />
        </a>
          <a class="atraitm_annuel"  href="traitement_annuel">
            <div class="affichage-ann">Affichage Annuel</div>
            <img
              class="traitm_annuel1"
              alt=""
              src="{% static 'images/traitement-de-linformation.png'%}"
            />
          </a>
          <a class="dash5"  href="dashboard">
            <div class="dash1">Dashboard</div>
            <img
              class="dash2"
              alt=""
              src="{% static 'images/tabelu de bord.png'%}" 
            />
          </a>
          <b class="menu">Menu</b>
          <div class="div3"></div>

          <div class="div4"></div>
        </div>
      </div>
      <a class="acceuil" href="login">
        <b class="deconnecte">se déconnecter</b>
      </a>
      <div class="div5" ></div>
      <div class="div6">
        <table class="tableau">
          <thead>
              {% if somme_attributs_par_region %}
                  <tr class="ligne">
                      <th><a href="#">Région</a></th>
                      <th><a href="#">Stock initial</a></th>
                      <th><a href="#">Apport de consommation interne</a></th>
                      <th><a href="#">Production</a></th>
                      <th><a href="#">Consommation</a></th>
                      <th><a href="#">Prélevé</a></th>
                      <th><a href="#">Pertes</a></th>
                      <th><a href="#">Expédition vers TRC</a></th>
                      <th><a href="#">Livraison</a></th>
                      <th><a href="#">Expédition vers TRC en m3</a></th>
                      <th><a href="#">Stock final</a></th>
                  </tr>
              {% endif %}
          </thead>
          <tbody>
              {% for region, attributs in somme_attributs_par_region.items %}
                  <tr class="donnee">
                      <td>{{ region.nom }}</td>
                      <td>{{ attributs.somme_stock_ini }}</td>
                      <td>{{ attributs.somme_apport_consommation }}</td>
                      <td>{{ attributs.somme_produit }}</td>
                      <td>{{ attributs.somme_consomme }}</td>
                      <td>{{ attributs.somme_preleve }}</td>
                      <td>{{ attributs.somme_pertes }}</td>
                      <td>{{ attributs.somme_expedie }}</td>
                      <td>{{ attributs.somme_laivraison }}</td>
                      <td>{{ attributs.somme_exp_trc }}</td>
                      <td>{{ attributs.somme_stock_final }}</td>
                  </tr>
              {% endfor %}
          </tbody>
      </table>     
    </div>
      <div class="div7">
        <form id="excelForm" action="{% url 'application:generate_excel' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="annee" id="excel_annee" value="{{ annee }}">
          <input type="hidden" name="mois" id="excel_mois" value="{{ mois }}">
          <button type="submit" class="btnexcel">EXCEL</button>
        </form>
        <img class="icon-pdf" alt="" src="{% static 'images/icon-excel .png' %}" />
        <form id="pdfForm" action="{% url 'application:generate_pdf' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="annee" id="pdf_annee" value="{{ annee }}">
          <input type="hidden" name="mois" id="pdf_mois" value="{{ mois }}">
          <button type="submit" class="btnpdf">PDF</button>
        </form>
        <img class="icon-excel" alt="" src="{% static 'images/icon-pdf 1.png'%}" />
      </div>
      <div class="div8">
        <form class="form1" method="post" action="{% url 'application:tableau_regions' %}">
          {% csrf_token %}
          <select class="select1" name="annee" id="annee-select">
              <option class="anne11" value="">Année</option>
              <option value="2021" class="option">2021</option>
              <option value="2022" class="option">2022</option>
              <option value="2023" class="option">2023</option>
              <option value="2024" class="option">2024</option>
          </select>
          <select class="select2" name="mois" id="mois-select"> 
              <option class="mois3" value="">Mois</option>
              <option value="janvier" class="option">janvier</option>
              <option value="février" class="option">février</option>
              <option value="mars" class="option">Mars</option>
              <option value="avril" class="option">avril</option>
              <option value="mai" class="option">mai</option>
              <option value="juin" class="option">juin</option>
              <option value="juillet" class="option">juillet</option>
              <option value="aout" class="option">aout</option>
              <option value="septembre" class="option">septembre</option>
              <option value="octobre" class="option">octobre</option>
              <option value="novembre" class="option">novembre</option>
              <option value="decembre" class="option">decembre</option>
          </select>
          <button type="submit" class="button" id="submitBtn">
            <i class="fa-solid fa-check"  style="color: gray;"></i>  
          </button>
      </form>
      </div>
      <a href="acceuil">
        <img class="logo" alt="Description de l'image" src="{% static 'images/logo.png' %}">
      </a>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
     var anneeSelect = document.querySelector('select[name="annee"]');
     var moisSelect = document.querySelector('select[name="mois"]');
     var selectedAnnee = localStorage.getItem('selectedAnnee');
     var selectedMois = localStorage.getItem('selectedMois');

     if (selectedAnnee) {
         anneeSelect.value = selectedAnnee;
     }
     if (selectedMois) {
         moisSelect.value = selectedMois;
     }
     anneeSelect.addEventListener('change', function() {
         localStorage.setItem('selectedAnnee', anneeSelect.value);
     });
     moisSelect.addEventListener('change', function() {
         localStorage.setItem('selectedMois', moisSelect.value);
     });
 
     document.querySelector('form').addEventListener('submit', function() {
         localStorage.setItem('selectedAnnee', anneeSelect.value);
         localStorage.setItem('selectedMois', moisSelect.value);
     });
 });
 
 document.getElementById('submitBtn').addEventListener('click', function(event) {
     const anneeSelect = document.getElementById('annee-select');
     const moisSelect = document.getElementById('mois-select');
 
     if (anneeSelect.value === "" || moisSelect.value === "") {
         event.preventDefault(); 
         alert("Veuillez sélectionner l'année et le mois."); 
     }
 });
 document.getElementById('pdfForm').addEventListener('submit', function(event) {
     const anneeInput = document.getElementById('pdf_annee');
     const moisInput = document.getElementById('pdf_mois');
     if (!anneeInput.value || !moisInput.value) {
         event.preventDefault(); 
         alert("Veuillez sélectionner l'année et le mois pour afficher le bilan à l'écran avant de générer le PDF.");
     }
 });
 document.getElementById('excelForm').addEventListener('submit', function(event) {
     const anneeInput = document.getElementById('excel_annee');
     const moisInput = document.getElementById('excel_mois');
     if (!anneeInput.value || !moisInput.value) {
         event.preventDefault(); 
         alert("Veuillez sélectionner l'année et le mois pour afficher le bilan à l'écran avant de télécharger le fichier Excel.");
     }
 });
   </script>
  </body>
</html>