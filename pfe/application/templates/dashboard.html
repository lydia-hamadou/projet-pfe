{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="{% static 'css/newglobal.css' %}" />
    <link rel="stylesheet" href="{% static 'css//dashboard.css' %}" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="dashboard">
      <img class="background" alt="" src="{% static 'images/finale_img.png'%}" />

      <div class="dashboard-inner">
        <div class="vector-parent21">
          <a class="traitement-de-linformation-2-parent9" style="color:white;" href="traitement_mansuel">
            <img
              class="traitement-de-linformation-2-icon12"
              alt=""
              src="{% static 'images/traitement-de-linformation (1).png'%}"
            />

            <div class="traitement-mansuelle11">Traitement Mansuelle</div>
          </a>
          <a class="affichage-bilan-par-primetre-parent6"  style="color:white;" href="traitement_p1">
            <div class="affichage-bilan-par-container8">
              <p class="affichage-bilan8">Affichage Bilan</p>
              <p class="affichage-bilan8">par périmetre</p>
            </div>
            <img class="bilan-2-icon12" alt="" src="{% static 'images/bilan.png'%}" />
         </a>
          <a class="affichage-annuel-parent21" href="traitement_annuel">
            <div class="affichage-annuel28">Affichage Annuel</div>
            <img
              class="traitement-de-linformation-1-icon20"
              alt=""
              src="{% static 'images/traitement-de-linformation.png'%}"
            />
          </a>
          <a class="dashboard-parent18" href="dashboard">
            <div class="dashboard24">Dashboard</div>
            <img
              class="tabelu-de-bord-214"
              alt=""
              src="{% static 'images/tabelu de bord.png'%}" 
            />
          </a>
          <b class="menu32">Menu</b>
          <div class="frame-child62"></div>
          <div class="frame-child63"></div>
        </div>
      </div>
      <div class="acceuil29">
        <b class="retour12">Retour</b>
      </div>
      <div class="rectangle-blanc" ></div>

      <img class="logo" style="background-color: transparent;" alt="" src="{% static 'images/logo.png'%}" />
    
      <div class="dashboard-pie">
        <canvas id="pie-chart"></canvas>
      </div>
      <div class="dashboard-bar">
        <canvas id="bar-chart"></canvas>
      </div>
      <div class="dashboard-line">
        <canvas id="line-chart"></canvas>
      </div>
      <div class="dashboard-child5"></div>
      <b class="donnees1">Donnees</b>
      <form class="rectangle-parent5" id="chartForm" action="{% url 'application:get_chart_data' %}" method="POST">
        {% csrf_token %}
        <input class="frame-child64" value="{{ dateFin }}" type="month" id="dateFin" name="dateFin">
        <select name="region" id="region" class="frame-child65">
            <option class="rgion1" value="">Région</option>
            <option value="Stah" class="option" {% if region == "Stah" %}selected{% endif %}>Stah</option>
            <option value="Adrar" class="option" {% if region == "Adrar" %}selected{% endif %}>Adrar</option>
            <option value="In Amenas" class="option" {% if region == "In Amenas" %}selected{% endif %}>In Amenass</option>
            <option value="Hassi Messaoud" class="option" {% if region == "Hassi Messaoud" %}selected{% endif %}>Hassi Messaoud</option>
        </select>

         <input class="frame-child66" value="{{dateDeb}}" type="month" id="dateDebut" name="dateDebut">
         <b for="dateDebut"  class="date-dbut1">Date de début:</b>
         <b class="date-fin1">Date fin:</b>
         <button class="frame-child67" type="submit"></button>
      </form>
      </div>
    </div>
  </body>
  <script>
    var data = {{data_pie_chart | safe}}
var labels = data.map(function(item) { return item.perimetre; });
var percentages = data.map(function(item) { return parseFloat(item.percentage); });
    var data2 = {{productionPrev | safe}}
var labels2 = data2.map(function(item) { return item.perimetre; });

var Production = data2.map(function(item) { return (item.production_mensuelle); });
var Prévision = data2.map(function(item) { return (item.prevision); });

  var data3 = {{production_previsions_mois | safe}}
var labels3 = data3.map(function(item) { return item.mois; });
var Production3 = data3.map(function(item) { return (item.production_mensuelle); });
var Prévision3 = data3.map(function(item) { return (item.prevision); });
      new Chart("pie-chart", {
          type: 'pie',
          data: {
              labels: labels,
              datasets: [{
                  data:percentages,
                  backgroundColor: [
                      'rgba(196, 196, 196,1)',
                      'rgba(250, 140, 0, 1)',
                      'rgba(21, 96, 122,1)',
                      'rgba(143, 27, 17, 1)',
                      'rgba(255, 213, 45, 1)',
                      'rgba(255, 202, 118, 1)',
                  ],
                  borderColor: [
                      'rgba(196, 196, 196,1)',
                      'rgba(250, 140, 0, 1)',
                      'rgba(21, 96, 122,1)',
                      'rgba(143, 27, 17, 1)',
                      'rgba(255, 213, 45, 1)',
                      'rgba(255, 202, 118, 1)',
                  ],
                  borderWidth: 1
              }]
          },
          options: {
              title: {
                  display: true,
                  text: 'Production par périmètre'
              }
          }
      });
  


      new Chart("bar-chart", {
          type: 'bar',
          data: {
              labels: labels2,
              datasets: [{
                  label: "Production",
                  data: Production,
                  backgroundColor: 'rgba(250, 140, 0, 1)',
                  borderColor: 'rgba(250, 140, 0, 1)',
                  borderWidth: 1
              }, {
                  label: "Prevision",
                  data: Prévision,
                  backgroundColor: 'rgba(21, 96, 122, 1)',
                  borderColor: 'rgba(21, 96, 122, 1)',
                  borderWidth: 1
              }]
          },
          options: {
              title: {
                  display: true,
                  text: 'Production par périmètre et mois'
              },
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
  


      new Chart("line-chart", {
          type: 'line',
          data: {
              labels:labels3,
              datasets: [{
                  label: 'Production',
                  data: Production3,
                  backgroundColor: 'rgba(21, 96, 122, 1)',
                  borderColor: 'rgba(21, 96, 122, 1)',
                  borderWidth: 1
              }, {
                  label: 'Prévision',
                  data: Prévision3,
                  backgroundColor: 'rgba(250, 140, 0, 1)',
                  borderColor: 'rgba(250, 140, 0, 1)',
                  borderWidth: 1
              }]
          },
          options: {
              title: {
                  display: true,
                  text: 'Évolution de la production et prévision'
              },
              scales: {
                  y: {
                      beginAtZero: true
                  }
              }
          }
      });
  
</script>
</html>
