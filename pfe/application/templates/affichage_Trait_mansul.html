{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="{% static 'css/global.css' %}" />
    <link rel="stylesheet" href="{% static 'css/page3.css' %}" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap"
    />
  </head>
  <body>
    <div class="page3">
      <img
        class="backgroung-page02-2-icon"
        alt=""
        src="C:\Users\Inspiron\Desktop\pfe images\page3.png"
      />

      <img class="page3-child" alt="" src="{% static 'images/pagee3.png'%}" />
      <div class="page3-inner"></div>

      <div class="page3-child1"></div>

      <a class="acceuil-wrapper" href="acceuil">
        <b class="acceuil">Acceuil</b>
      </a>
      <form id="save-form" method="post" onsubmit="event.preventDefault(); saveData()">
        <button type="submit" class="page3-child2"></button>
        <h2 class="valider1" >valider</h2>
      </form>
      <h2 class="test1" onclick="testData()">Test</h2>
      <form id="test-form" method="post" onsubmit="event.preventDefault(); testData()" style="display: none;">
        <button type="submit" class="page3-child3"></button>
      </form>
      <button class="page3-childd"> </button>
      <h2 class="resultat1">Résultat</h2>
      <div class="background-page03-2"></div>
      <div class="page3-child4" id="result-container">
        {% if data %}
        <table (style="border:'1';") >
          <tr>
            <th>Mois</th>
            <th>Année</th>
            <th>Stock initial</th>
            <th>Apport consommation</th>
            <th>Produit</th>
            <th>Consomme</th>
            <th>Prélève</th>
            <th>Pertes</th>
            <th>Expédié</th>
            <th>Livraison</th>
            <th>Densité</th>
            <th>Périmètre</th>
          </tr>
          {% for row in data %}
          <tr>
            <td>{{ row.mois }}</td>
            <td>{{ row.annee }}</td>
            <td>{{ row.stock_ini }}</td>
            <td>{{ row.Apport_consommation }}</td>
            <td>{{ row.produit }}</td>
            <td>{{ row.consomme }}</td>
            <td>{{ row.preleve }}</td>
            <td>{{ row.pertes }}</td>
            <td>{{ row.expedie }}</td>
            <td>{{ row.livraison }}</td>
            <td>{{ row.densite }}</td>
            <td>{{ row.perimetre }}</td>
          </tr>
          {% endfor %}
        </table>
        <br>
        {% else %}
        <p>No data available</p>
        {% endif %}
        
      </div>
      <div class="group-container">
        <div class="frame-container">
          <a class="vector-group"  href="">
            <div class="frame-child3"></div>

            <a class="dashboard-parent1" href="dashboard">
              <div class="dashboard5">Dashboard</div>
              <img
                class="tabelu-de-bord-21"
                alt=""
                src="{% static 'images/tabelu de bord.png'%}" 
              />
            </a>
          </a>
        </div>
       
        <a class="affichage-annuel-parent1" href="traitement_annuel">
          <div class="affichage-annuel5">Affichage Annuel</div>
          <div class="line-div"></div>
          <img
            class="tabelu-de-bord-21"
            alt=""
            src="{% static 'images/traitement-de-linformation.png'%}"
          />
        </a>
        <a class="affichage-p1-parent1" href="traitement_p1">
          <div class="affichage-p16">Affichage P1</div>
          <div class="frame-child4"></div>
          <img class="tabelu-de-bord-12" alt="" src="{% static 'images/bilan.png'%}" />
        </a>
        <a class="traitement-mensuel-parent1"  href="traitement_mansuel">
          <div class="traitement-mensuel5">Traitement mensuel</div>
          <img
            class="traitement-de-linformation-1-icon6"
            alt=""
            src="{% static 'images/traitement-de-linformation (1).png'%}"
          />
        </a>
        <div class="group-child1"></div>

        <div class="group-child2"></div>

        <b class="menu5">Menu</b>
        <img class="logo-icon3" alt="" src="{% static 'images/logo.png'%}"  />
      </div>
      <img class="icon" alt="" src="{% static 'images/5305199.png '%}" />

      <img
        class="product-testing-service-test-i-icon"
        alt=""
        src="{% static 'images/77-774666_product-testing-service-test-icon-hd-png-download.png'%}"
      />


      <img
        class="tlchargement-1-icon"
        alt=""
        src="{% static 'images/téléchargement.png'%}"
      />
    </div>
  </body>
  <script src="{% static 'js/page2.js' %}"></script>
  <script>
   function saveData() {
    const data = {}; // Collect data to send
    fetch('/save_data/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Failed to save data');
        }
    })
    .then(data => {
        // Handle response data if needed
    })
    .catch(error => console.error('Error:', error));
}

function testData() {
    const data = {}; // Collect data to send
    fetch('/test_data/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Failed to test data');
        }
    })
    .then(data => {
        // Handle response data if needed
    })
    .catch(error => console.error('Error:', error));
}

function displayData(data) {
    const resultContainer = document.getElementById('result-container');
    resultContainer.innerHTML = ''; // Clear previous content
    
    if (data.length === 0) {
        resultContainer.innerHTML = '<p>No data available</p>';
        return;
    }
    
    const table = document.createElement('table');
    table.style.border = '1px solid black';
    
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    for (const key in data[0]) {
        const th = document.createElement('th');
        th.textContent = key;
        headerRow.appendChild(th);
    }
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    const tbody = document.createElement('tbody');
    data.forEach(row => {
        const tr = document.createElement('tr');
        for (const key in row) {
            const td = document.createElement('td');
            td.textContent = row[key];
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);
    
    resultContainer.appendChild(table);
}

document.getElementById('file-upload-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(this);
    fetch('/upload_file/', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        displayData(data);
    })
    .catch(error => console.error('Error:', error));
});

  </script>
</html>
